
<div>

<div>

<span>

<span>

<div>

<section>

<p>

<img src="https://img.atcoder.jp/ahc018/a8a5bc5edd5e6d6301e8f4bd11f3c531.gif">

</img>

</p>

### **問題文**

<p>
$N$行 $N$列のグリッドで表される土地があります。

グリッドのうち $W$箇所に
<b>
水源
</b>
があり、 $K$箇所に
<b>
家
</b>
があります。

土地の上から $i$行目（ $0 \leq i \lt N $）、左から $j$列目（ $0 \leq j \lt N $）のセルを $(i, j)$と表すことにします。

各セル $(i, j)$の
<b>
岩盤
</b>
には、$10$以上 $5000$以下の整数で表される 
<b>
頑丈さ
</b>
$S_{i,j}$が予め設定されていますが、これらの値は入力では与えられません。


</p>

<p>

<b>
水源
</b>
が存在するセルの
<b>
岩盤
</b>
を破壊すると、そのセルに水が流れます。

また、水が流れているセルの上下左右に隣接する
<b>
岩盤
</b>
が破壊されたセルにも水が流れます。

土地の管理者であるXさんは、いくつかの
<b>
岩盤
</b>
を破壊して、
<b>
家
</b>
が存在する全てのセルに水が流れるようにしたいです。


<b>
家
</b>
が存在するセルに水を流すには、そのセルの
<b>
岩盤
</b>
も破壊する必要がある点に注意してください。


</p>

<p>

<b>
岩盤
</b>
を破壊するためには、Xさんは以下の
<b>
掘削
</b>
を繰り返し行います。


</p>

<ul>

<li>
まだ
<b>
岩盤
</b>
が破壊されていないセル $(i, j)$を一つと、
<b>
パワー
</b>
を表す $5000$以下の正の整数 $P$を一つ選びます。
                            
</li>

<li>
Xさんの
<b>
体力
</b>
を $C+P$（$C$は入力で与えられる正の整数）消費して、セルの
<b>
岩盤
</b>
の
<b>
頑丈さ
</b>
$S_{i,j}$を $P$減らします。
                            
</li>

<li>
この操作で $S_{i,j} \leq 0$となった場合、セル $(i, j)$の
<b>
岩盤
</b>
が破壊されます。
                            
</li>

</ul>

<p>

</p>

<p>
なるべくXさんの
<b>
体力
</b>
を消費しないように工夫しながら、
<b>
家
</b>
が存在する全てのセルに水が流れるようにしてください。
                    
</p>

</section>

</div>

---

<div>

<section>

### **得点・順位付け**

<p>
相対評価システムを採用します。

各テストケース毎に、$\mathrm{round} \lparen 10^9 \times \frac{全参加者中の最小消費体力}{自身の消費体力} \rparen $の相対評価スコアが得られ、その和が提出の得点となります。
                    
</p>

<p>
最終順位はコンテスト終了後に実施されるより多くの入力に対するシステムテストにおける得点で決定されます。暫定テスト・システムテストのどちらにおいても、一部のテストケースで不正な出力や制限時間超過をした場合、そのテストケースに関する相対評価スコアは0点となり、そのテストケースにおいては「全参加者中の最小消費体力」の計算対象から除外されます。


</p>

<p>
また、システムテストは 
<font color="red">
<strong>

<span>
CE
</span>
以外の結果を得た一番最後の提出
</strong>
</font>
に対してのみ行われるため、最終的に提出する解答を間違えないよう注意してください。
                    
</p>

#### **テストケース数**

<ul>

<li>
暫定テスト: 50個
                        
</li>

<li>
システムテスト: 3000個
                            
<ul>

<li>
システムテストでは、$C$は $\{ 1,2,4,8,16,32,64,128 \}$のそれぞれの値について、375個ずつのテストケースが存在します。
</li>

<li>
コンテスト終了後に <a href="https://img.atcoder.jp/ahc018/seeds.txt">seeds.txt</a>(sha256=`3bbc58026730d18fcb0e03ead929ab2afb6f9f0c5eb7f0c10ac44df4e6b84a3f`) を公開します。
</li>

</ul>

</li>

</ul>

#### **相対評価システムについて**

<p>
暫定テスト・システムテストともに、
<span>
CE
</span>
以外の結果を得た一番最後の提出のみが順位表に反映されます。

相対評価スコアの計算に用いられる各テストケース毎の「全参加者中の最小消費体力」の算出には、各参加者の順位表に反映されている提出のみが用いられます。

順位表に表示されるスコアは相対評価スコアであり、新規提出があるたびに相対評価スコアが再計算されます。 一方、提出一覧から確認できる各提出のスコアは、各テストケース毎の消費体力をそのまま足し合わせたものであり、相対評価スコアは表示されません。 最新以外の提出の、現在の順位表における相対評価スコアを知るためには、再提出が必要となります。

不正な出力や制限時間超過をした場合、提出一覧から確認できるスコアは0となりますが、順位表には正解したテストケースに対する相対評価スコアの和が表示されます。


</p>

#### **実行時間について**

<p>
実行時間には多少のブレが生じます。
                        また、システムテストでは同時に大量の実行を行うため、暫定テストに比べて数%程度実行時間が伸びる現象が確認されています。
                        そのため、実行時間制限ギリギリの提出がシステムテストで
<span>
TLE
</span>
となる可能性があります。
                        プログラム内で時間を計測して処理を打ち切るか、実行時間に余裕を持たせるようお願いします。
                    
</p>

</section>

</div>

---

<div>

<div>

<section>

### **入出力**

<p>

<b>
※この問題はインタラクティブ形式です。以下の内容を読み、ジャッジプログラムとのやり取りを行ってください。
</b>

</p>

<p>
最初に、入力が以下の形式で標準入力から与えられます。
                        
</p>

<div>

\(
N ~ W ~ K ~ C \\
a_0 ~ b_0 \\
\vdots \\
a_{W-1} ~ b_{W-1} \\
c_0 ~ d_0 \\
\vdots \\
c_{K-1} ~ d_{K-1}\)

</div>

<p>

</p>

<ul>

<li>
1行目には4つの整数 $N,W,K,C$がスペース区切りで与えられます。
                                    
<ul>

<li>
$N$は土地のサイズを表し、 $N = 200$です。
</li>

<li>
$W$は
<b>
水源
</b>
の数を表し、 $1 \leq W \leq 4$を満たします。
</li>

<li>
$K$は
<b>
家
</b>
の数を表し、 $1 \leq K \leq 10$を満たします。
</li>

<li>
$C$は
<b>
体力
</b>
の消費に関係するパラメータで、 $C \in \{ 1,2,4,8,16,32,64,128 \}$を満たします。
</li>

</ul>

</li>

<li>
続く $W+K$行には、
<b>
水源
</b>
と
<b>
家
</b>
が存在するセルの位置を表す2つの整数がスペース区切りで与えられます。
                                    
<ul>

<li>
最初に、 $W$行で与えられる2整数 $a_i, b_i$は、 セル $(a_i, b_i)$に
<b>
水源
</b>
が存在することを表します。$0 \leq a_i \lt N, 0 \leq b_i \lt N$を満たします。
                                        
</li>

<li>
続いて、 $K$行で与えられる2整数 $c_i, d_i$は、 セル $(c_i, d_i)$に
<b>
家
</b>
が存在することを表します。$0 \leq c_i \lt N, 0 \leq d_i \lt N$を満たします。
                                        
</li>

<li>
全ての
<b>
水源
</b>
同士のペア・全ての
<b>
家
</b>
同士のペア・全ての
<b>
水源
</b>
と
<b>
家
</b>
のペアは、<a href="https://ja.wikipedia.org/wiki/%E3%83%9E%E3%83%B3%E3%83%8F%E3%83%83%E3%82%BF%E3%83%B3%E8%B7%9D%E9%9B%A2">マンハッタン距離</a>で $\mathrm{round}(400/(W+K))$以上離れていることが保証されます。
</li>

</ul>

</li>

</ul>

<p>

</p>

<p>
ここまでの入力を受け取った後は、
<b>
掘削
</b>
をどのように実行するかを以下の形式で標準出力へ出力してください。


</p>

<div>

\(y ~ x ~ P\)

</div>

<p>

</p>

<ul>

<li>
1行目に3つの整数 $y,x,P$をスペース区切りで出力します。
                                    
<ul>

<li>
セル $(y,x)$に対して、
<b>
パワー
</b>
$P$で
<b>
掘削
</b>
を行います。
</li>

<li>
セル $(y,x)$の
<b>
岩盤
</b>
はまだ破壊されていない必要があり、かつ、$1 \leq P \leq 5000$を満たす必要があります。そうしなかった場合、
<span>
WA
</span>
となります。
</li>

<li>
出力の後には
<font color="red">
<strong>
改行をし、標準出力をflushする必要があります
</strong>
</font>
。そうしなかった場合、
<span>
TLE
</span>
となる可能性があります。
</li>

</ul>

</li>

</ul>

<p>

</p>

<p>
出力後、
<b>
掘削
</b>
を実行した結果が入力として以下の形式で標準入力から与えられます。
                        
</p>

<div>

\(r\)

</div>

<p>

</p>

<ul>

<li>
1行に1つの整数 $r$が与えられます。
                                    
<ul>

<li>
指定したセルの
<b>
岩盤
</b>
が破壊できなかった場合は `0`となります。
</li>

<li>
指定したセルの
<b>
岩盤
</b>
が破壊できた場合、
<b>
家
</b>
が存在するセルでまだ水が流れていないものがあるならば `1`、
<b>
家
</b>
が存在する全てのセルに水が流れているならば `2`となります。
</li>

<li>
不正な出力だった場合は `-1`となります。
</li>

</ul>

</li>

<li>
$r \in \{-1, 2\}$の場合は、直ちにプログラムを終了してください。そうしなければ、
<span>
TLE
</span>
となる可能性があります。
</li>

<li>
$r \in \{0, 1\}$の場合は、
<b>
家
</b>
が存在するセルでまだ水が流れていないものがあるため、引き続き
<b>
掘削
</b>
を行う必要があります。$r \in \{-1, 2\}$となるまで、
<b>
掘削
</b>
をどのように実行するかを繰り返し出力し、繰り返し入力を受け取ってください。
</li>

</ul>

<p>

</p>

</section>

</div>

<div>

<section>

### **入力生成方法**

<details>

<p>
$L$以上 $U$以下の整数値を一様ランダムに生成する関数を $\mathrm{rand}(L,U)$で、$L$以上 $U$以下の実数値を一様ランダムに生成する関数を $\mathrm{randf}(L,U)$で、$b$の $p$乗を返す関数を $\mathrm{pow}(b,p)$で表す。
</p>

#### **$S_{i,j}$の生成**

<ol>

<li>
乱数シード $seed$を元に、 -1.0以上1.0以下の範囲にスケーリングされた二次元の <a href="https://ja.wikipedia.org/wiki/%E3%83%91%E3%83%BC%E3%83%AA%E3%83%B3%E3%83%8E%E3%82%A4%E3%82%BA">Perlin noise</a>を生成する関数を $\mathrm{noise}(y,x,seed)$で表す。

以下のようにパラメタを選ぶ。
                                    
<ul>

<li>
$f0 = \mathrm{randf}(2.0,8.0)$
</li>

<li>
$f1 = \mathrm{randf}(10.0,20.0)$
</li>

<li>
$dy0 = \mathrm{randf}(0.0,1.0)$
</li>

<li>
$dy1 = \mathrm{randf}(0.0,1.0)$
</li>

<li>
$dx0 = \mathrm{randf}(0.0,1.0)$
</li>

<li>
$dx1 = \mathrm{randf}(0.0,1.0)$
</li>

<li>
$seed0 = \mathrm{rand}(0,2^{32} - 1)$
</li>

<li>
$seed1 = \mathrm{rand}(0,2^{32} - 1)$
</li>

</ul>
各 $i, j$（ $0 \leq i, j \lt N $）に対して、 $S_{i,j} = \mathrm{noise}(f0 \times i / N + dy0, f0 \times j / N + dx0, seed0) + 0.2 \times \mathrm{noise}(f1 \times i / N + dy1, f1 \times j / N + dx1, seed1)$とする。
                                
</li>

<li>
$S_{i,j} = 1.0 / (1.0 + \mathrm{exp}(-3.0 \times (S_{i,j} - 0.25)))$と更新する。（ロジスティック関数で変換をしている）
                                
</li>

<li>
$p = \mathrm{randf}(2.0,4.0)$を選ぶ。 $S_{i,j} = \mathrm{pow}(S_{i,j},p)$と更新する。
                                
</li>

<li>
$S_{i,j}$を、 $10$以上 $5000$以下の範囲に線形スケーリングする。

すなわち、 $S_{i,j}$（ $0 \leq i, j \lt N $）の中で最小の値を $l$, 最大の値を $u$としたとき、 $S_{i,j} = \mathrm{round}((S_{i,j} - l) \times (5000 - 10) / (u - l) + 10)$と更新する。
                                
</li>

</ol>

#### **水源と家の位置の生成**

<ol>

<li>
$W = \mathrm{rand}(1,4)$, $K = \mathrm{rand}(1,10)$とする。
</li>

<li>
$W$箇所の
<b>
水源
</b>
の位置$(a_i, b_i)$, $K$箇所の
<b>
家
</b>
の位置$(c_i, d_i)$を、それぞれ独立に、$N ^ 2$個のセルの中から $S_{i,j}$に反比例する確率で選ぶ。
</li>

<li>
$W+K$箇所の位置の中にマンハッタン距離が $\mathrm{round}(400/(W+K))$未満の組がある場合、2. からやり直す。
</li>

</ol>

#### **$C$の生成**

<p>
$C = \mathrm{pow}(2,\mathrm{rand}(0,7))$と生成する。
</p>

</details>

<p>
必ずしも理解する必要はありません。
</p>

<p>
厳密な実装は入力ジェネレータのソースコードをご覧ください。
</p>

</section>

</div>

<div>

<section>

### **ツール（入力ジェネレータ・ビジュアライザ・ローカルテスタ・サンプルコード）**

<ul>

<li>
<a href="https://img.atcoder.jp/ahc018/6bada50282.html?lang=ja">Web版</a>: アニメーション表示が可能です。
</li>

<li>
<a href="https://img.atcoder.jp/ahc018/6bada50282.zip">ローカル版</a>: 使用するには<a href="https://www.rust-lang.org/ja">Rust言語</a>のコンパイル環境をご用意下さい。
                                
<ul>

<li>
<a href="https://img.atcoder.jp/ahc018/6bada50282_windows.zip">Windows用のコンパイル済みバイナリ</a>: Rust言語の環境構築が面倒な方は代わりにこちらをご利用下さい。
</li>

</ul>

</li>

<li>
<a href="https://img.atcoder.jp/ahc018/6bada50282_sample.zip">サンプルコード（C++, Python）</a>: サンプルの解答です。次の処理を実装しています。
                                
<ul>

<li>
それぞれの
<b>
家
</b>
について、一つ目の
<b>
水源
</b>
まで最短距離でまっすぐに
<b>
掘削
</b>
を行う
</li>

<li>

<b>
パワー
</b>
は常に `100`に設定する
</li>

<li>
ジャッジプログラムから `2`が返されたら、消費体力を標準エラー出力に出力して終了する
</li>

</ul>

</li>

</ul>

<p>

<font color="red">
<strong>
コンテスト終了までビジュアライズ結果の共有は禁止されています。ご注意下さい。
</strong>
</font>

</p>

#### **ツールで用いられる入出力ファイルの仕様**

<p>
ローカルテスタに与える入力ファイルは以下の形式を用いています。
</p>

<div>

\(
N ~ W ~ K ~ C \\
S_{0,0} ~ \cdots ~ S_{0,N-1} \\
\vdots \\
S_{N-1,0} ~ \cdots ~ S_{N-1 ,N-1} \\
a_0 ~ b_0 \\
\vdots \\
a_{W-1} ~ b_{W-1} \\
c_0 ~ d_0 \\
\vdots \\
c_{K-1} ~ d_{K-1} \)

</div>

<p>
$S_{i,j}$はセル $(i, j)$にある
<b>
岩盤
</b>
の
<b>
頑丈さ
</b>
の初期値です。
</p>

<p>
ローカルテスタは解答プログラムの出力をそのまま出力ファイルに書き出します。
                        解答プログラムは、`#`から始まるコメント行を出力に含めてもかまいません。
                        Web版ビジュアライザを使用すると、コメント行を対応する
<b>
掘削
</b>
と合わせて表示できるため、デバッグや考察等に役立てることができます。
                        ジャッジプログラムはコメント行を全て無視するため、コメント行を出力するプログラムをそのまま提出可能です。
                    
</p>

</section>

</div>

</div>

---

<div>

<section>

### **入出力例**

<table>

<thead>

<tr>

<th>
Input
</th>

<th>
Output
</th>

<th>
説明
</th>

</tr>

</thead>

<tbody>

<tr>

<td>

<div>

3 1 1 128
0 0
1 1

</div>

</td>

<td>

</td>

<td>
入力の制約を満たさない、説明用の入力である点に注意してください。

$3 \times 3$のグリッドで表される土地の $(0,0)$に
<b>
水源
</b>
が存在し、 $(1,1)$に
<b>
家
</b>
が存在します。
                                
</td>

</tr>

<tr>

<td>

</td>

<td>

<div>

0 0 872

</div>

</td>

<td>
セル $(0,0)$に対して、
<b>
パワー
</b>
$872$で
<b>
掘削
</b>
をします。この際、
<b>
体力
</b>
を$128+872 = 1000$消費します。
                                
</td>

</tr>

<tr>

<td>

<div>

0

</div>

</td>

<td>

</td>

<td>
この
<b>
掘削
</b>
では、セル $(0,0)$の
<b>
岩盤
</b>
は壊れませんでした。

ですが、セル $(0,0)$の
<b>
岩盤
</b>
の
<b>
頑丈さ
</b>
は $872$減りました。


</td>

</tr>

<tr>

<td>

</td>

<td>

<div>

0 0 2

</div>

</td>

<td>
セル $(0,0)$に対して、
<b>
パワー
</b>
$2$で
<b>
掘削
</b>
をします。この際、
<b>
体力
</b>
を$128+2 = 130$消費します。
                                
</td>

</tr>

<tr>

<td>

<div>

1

</div>

</td>

<td>

</td>

<td>
この
<b>
掘削
</b>
で、セル $(0,0)$の
<b>
岩盤
</b>
が壊れました。

セル $(0,0)$に水が流れるようになります。


</td>

</tr>

<tr>

<td>

</td>

<td>

<div>

1 1 872

</div>

</td>

<td>
セル $(1,1)$に対して、
<b>
パワー
</b>
$872$で
<b>
掘削
</b>
をします。この際、
<b>
体力
</b>
を$128+872 = 1000$消費します。
                                
</td>

</tr>

<tr>

<td>

<div>

1

</div>

</td>

<td>

</td>

<td>
セル $(1,1)$の
<b>
岩盤
</b>
が壊れました。


</td>

</tr>

<tr>

<td>

</td>

<td>

<div>

1 0 872

</div>

</td>

<td>
セル $(1,0)$に対して、
<b>
パワー
</b>
$872$で
<b>
掘削
</b>
をします。この際、
<b>
体力
</b>
を$128+872 = 1000$消費します。
                                
</td>

</tr>

<tr>

<td>

<div>

2

</div>

</td>

<td>

</td>

<td>
セル $(1,0)$の
<b>
岩盤
</b>
が壊れました。

セル $(0,0)$, $(1,0)$, $(1,1)$に水が流れるようになり、
<b>
家
</b>
が存在する全てのセルに水が流れるようになりました。

ジャッジプログラムから`2`が返されたら、直ちにプログラムを終了してください。

消費した
<b>
体力
</b>
の合計である $1000+130+1000+1000 = 3130$が相対評価スコアの計算に用いられます。


</td>

</tr>

</tbody>

</table>

</section>

</div>

</span>

</span>

</div>

</div>
